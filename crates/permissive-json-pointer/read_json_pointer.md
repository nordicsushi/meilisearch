# Permissive JSON Pointer å­¦ä¹ ç¬”è®°

## Introduction

æœ¬æ–‡æ¡£è§£é‡Šæ ‡å‡† JSON Pointer æ¦‚å¿µä»¥åŠ Meilisearch çš„ `permissive-json-pointer` crate çš„å®ç°å·®å¼‚ã€‚

---

## ğŸ“Œ æ ‡å‡† JSON Pointer (RFC 6901)

JSON Pointer æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼ˆRFC 6901ï¼‰ï¼Œç”¨äº**ç²¾ç¡®å®šä½** JSON æ–‡æ¡£ä¸­çš„æŸä¸ªå€¼ã€‚

### è¯­æ³•è§„åˆ™

- ä½¿ç”¨ `/` ä½œä¸ºåˆ†éš”ç¬¦
- ä½¿ç”¨æ•°ç»„ç´¢å¼•è®¿é—®æ•°ç»„å…ƒç´ 
- æœ‰è½¬ä¹‰è§„åˆ™ï¼š`~0` = `~`ï¼Œ`~1` = `/`

### æ ‡å‡†ç¤ºä¾‹

```json
{
  "name": "Alice",
  "pets": [
    {
      "type": "dog",
      "name": "Max"
    },
    {
      "type": "cat", 
      "name": "Luna"
    }
  ],
  "address": {
    "city": "Paris"
  }
}
```

**æ ‡å‡† JSON Pointer è®¿é—®ï¼š**

| Pointer | è¿”å›å€¼ | è¯´æ˜ |
|---------|--------|------|
| `/name` | `"Alice"` | æ ¹çº§åˆ«çš„ name |
| `/pets/0/name` | `"Max"` | ç¬¬ä¸€ä¸ªå® ç‰©çš„åå­— |
| `/pets/1/type` | `"cat"` | ç¬¬äºŒä¸ªå® ç‰©çš„ç±»å‹ |
| `/address/city` | `"Paris"` | åµŒå¥—å¯¹è±¡çš„å€¼ |

**æ ‡å‡† JSON Pointer ç‰¹ç‚¹ï¼š**
- âœ… **ç²¾ç¡®å®šä½**å•ä¸ªå€¼
- âœ… å¯ä»¥è®¿é—®æ•°ç»„çš„ç‰¹å®šç´¢å¼•
- âœ… è·¯å¾„æ˜ç¡®ï¼Œä¸å­˜åœ¨æ­§ä¹‰
- âŒ æ¯æ¬¡åªèƒ½å–ä¸€ä¸ªå€¼
- âŒ ä¸èƒ½æ¨¡ç³ŠåŒ¹é…
- âŒ ä¸èƒ½åŒæ—¶è®¿é—®æ•°ç»„æ‰€æœ‰å…ƒç´ 

---

## ğŸŒŸ Permissive JSON Pointer çš„ä¸åŒ

è¿™ä¸ª crate çš„è®¾è®¡ç†å¿µå®Œå…¨ä¸åŒï¼Œå®ƒæ˜¯ä¸º **Meilisearch çš„å­—æ®µé€‰æ‹©** åœºæ™¯è®¾è®¡çš„ã€‚

### æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”

| ç‰¹æ€§ | æ ‡å‡† JSON Pointer | Permissive JSON Pointer |
|------|------------------|------------------------|
| **åˆ†éš”ç¬¦** | `/` | `.` |
| **è®¾è®¡ç›®æ ‡** | å®šä½å•ä¸ªå€¼ | ç­›é€‰å¤šä¸ªå­—æ®µ |
| **æ•°ç»„è®¿é—®** | ç”¨ç´¢å¼• `/pets/0` | åº”ç”¨åˆ°æ‰€æœ‰å…ƒç´  `pets.name` |
| **å†²çªå¤„ç†** | ä¸å­˜åœ¨ï¼ˆè·¯å¾„æ˜ç¡®ï¼‰ | **å…¨éƒ¨åŒ¹é…**ï¼ˆæåº¦å®½æ¾ï¼‰ |
| **è¿”å›ç»“æœ** | å•ä¸ªå€¼ | æ–°çš„ JSON å¯¹è±¡ï¼ˆåªå«é€‰ä¸­å­—æ®µï¼‰ |
| **åŒ¹é…ç­–ç•¥** | ç²¾ç¡®åŒ¹é… | æ¨¡ç³ŠåŒ¹é…ï¼ˆèƒ½åŒ¹é…çš„éƒ½åŒ¹é…ï¼‰ |

### å®½æ¾åŒ¹é…ç¤ºä¾‹

å¯¹äºè¿™ä¸ª"æ··ä¹±"çš„ JSONï¼š

```json
{
  "pet.dog.name": "jean",           // é”®åæœ¬èº«å°±åŒ…å«ç‚¹
  "pet.dog": {
    "name": "bob"                    // åµŒå¥—å¯¹è±¡
  },
  "pet": {
    "dog.name": "michel",            // å¦ä¸€ç§åµŒå¥—æ–¹å¼
    "dog": {
      "name": "milan"                 // å†ä¸€ç§åµŒå¥—æ–¹å¼
    }
  }
}
```

**ç”¨ `pet.dog.name` é€‰æ‹©å™¨ï¼š**

- **æ ‡å‡† JSON Pointer**ï¼šä¼šå¤±è´¥æˆ–åªåŒ¹é…ä¸€ä¸ªï¼ˆéœ€è¦ç²¾ç¡®è·¯å¾„ï¼‰
- **Permissive**ï¼š**å››ä¸ªéƒ½åŒ¹é…ï¼**

```json
{
  "pet.dog.name": "jean",      // âœ… åŒ¹é…ï¼ˆå­—é¢é”®åï¼‰
  "pet.dog": {
    "name": "bob"               // âœ… åŒ¹é…ï¼ˆåµŒå¥—å¯¹è±¡ï¼‰
  },
  "pet": {
    "dog.name": "michel",       // âœ… åŒ¹é…ï¼ˆæ··åˆæ–¹å¼ï¼‰
    "dog": {
      "name": "milan"            // âœ… åŒ¹é…ï¼ˆå®Œå…¨åµŒå¥—ï¼‰
    }
  }
}
```

### æ•°ç»„å¤„ç†çš„ä¸åŒ

**æ ‡å‡† JSON Pointer**ï¼ˆè®¿é—®ç‰¹å®šå…ƒç´ ï¼‰ï¼š
```
/pets/0/name  â†’ åªè¿”å›ç¬¬ä¸€ä¸ªå® ç‰©çš„åå­— "Max"
```

**Permissive**ï¼ˆåº”ç”¨åˆ°æ‰€æœ‰å…ƒç´ ï¼‰ï¼š
```rust
select_values(json, ["pets.name"])
```

ç»™å®šè¾“å…¥ï¼š
```json
{
  "pets": [
    { "name": "Max", "age": 3 },
    { "name": "Luna", "age": 5 },
    { "type": "bird" }  // æ²¡æœ‰ name å­—æ®µ
  ]
}
```

è¿”å›ç»“æœï¼š
```json
{
  "pets": [
    { "name": "Max" },
    { "name": "Luna" }
    // ç¬¬ä¸‰ä¸ªå…ƒç´ æ²¡æœ‰ nameï¼Œæ‰€ä»¥è¢«è¿‡æ»¤æ‰äº†
  ]
}
```

**å…³é”®ä¸åŒ**ï¼š
- æ ‡å‡†æ–¹å¼éœ€è¦åˆ†åˆ«è®¿é—® `/pets/0/name` å’Œ `/pets/1/name`
- Permissive æ–¹å¼ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ•°ç»„å…ƒç´ 

---

## ğŸ¯ ä¸ºä»€ä¹ˆè®¾è®¡å¾—å¦‚æ­¤å®½æ¾ï¼Ÿ

ä»ä»£ç æ³¨é‡Šå¯ä»¥çœ‹å‡ºè®¾è®¡è€…çš„è€ƒè™‘ï¼š

```rust
// What a crappy json! But never underestimate your users, 
// they WILL somehow base their entire workflow on this kind of json.
```

**è®¾è®¡åŸå› ï¼š**

1. **æœç´¢å¼•æ“åœºæ™¯**ï¼šMeilisearch éœ€è¦å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„ä»»æ„ç»“æ„çš„ JSON
2. **ç”¨æˆ·å‹å¥½**ï¼šç”¨æˆ·å¯èƒ½ä¸æ¸…æ¥šå­—æ®µåˆ°åº•æ˜¯ `dog.name`ï¼ˆå­—é¢é”®åï¼‰è¿˜æ˜¯åµŒå¥—çš„ `dog` â†’ `name` ç»“æ„
3. **å®½å®¹æ€§åŸåˆ™**ï¼šå®å¯å¤šåŒ¹é…ä¹Ÿä¸æ¼æ‰æ•°æ®ï¼ˆæœç´¢å¼•æ“çš„æ ¸å¿ƒå“²å­¦ï¼‰
4. **å¤šæºæ•°æ®**ï¼šåŒä¸€ä»½ JSON å¯èƒ½æ¥è‡ªä¸åŒç³»ç»Ÿï¼Œç»“æ„ä¸ç»Ÿä¸€

**å“²å­¦å¯¹æ¯”ï¼š**
- **æ ‡å‡† JSON Pointer**ï¼šä¸¥æ ¼ã€ç²¾ç¡®ã€ç¨‹åºå‘˜å‹å¥½
- **Permissive JSON Pointer**ï¼šå®½æ¾ã€æ¨¡ç³Šã€ç”¨æˆ·å‹å¥½

---

## ğŸ“ åœ¨ Meilisearch ä¸­çš„å®é™…ç”¨é€”

åœ¨ Meilisearch API ä¸­ä½¿ç”¨åœºæ™¯ï¼š

```http
POST /indexes/movies/search
{
  "q": "action",
  "attributesToRetrieve": ["title", "cast.name", "director.info.name"]
}
```

è¿™ä¸ª crate ç¡®ä¿ï¼š
- æ— è®ºç”¨æˆ·çš„ JSON ç»“æ„å¤šå¥‡æ€ª
- åªè¦"çœ‹èµ·æ¥åƒ" `cast.name` çš„å­—æ®µ
- éƒ½ä¼šè¢«è¯†åˆ«å¹¶è¿”å›

**å¦ä¸€ä¸ªç”¨é€”ï¼šå­—æ®µæŠ•å½±ï¼ˆField Projectionï¼‰**

```rust
// ç”¨æˆ·ä¸Šä¼ çš„å¤æ‚æ–‡æ¡£
let document = json!({
    "title": "Inception",
    "cast": [
        { "name": "Leonardo", "age": 45 },
        { "name": "Tom", "age": 55 }
    ],
    "metadata": { /* å¤§é‡å…¶ä»–å­—æ®µ */ }
});

// åªè¿”å›éœ€è¦çš„å­—æ®µ
let result = select_values(&document, ["title", "cast.name"]);
// ç»“æœåªåŒ…å« title å’Œ cast æ•°ç»„ä¸­çš„ name å­—æ®µ
```

---

## ğŸ” ç®€å•ç±»æ¯”

ç†è§£ä¸¤è€…åŒºåˆ«çš„æœ€ä½³ç±»æ¯”ï¼š

| æ ‡å‡† JSON Pointer | Permissive JSON Pointer |
|-------------------|------------------------|
| GPS ç²¾ç¡®å¯¼èˆª | æ¨¡ç³Šæœç´¢ |
| å¿…é¡»çŸ¥é“å‡†ç¡®åœ°å€ | "é™„è¿‘çš„éƒ½å‘Šè¯‰æˆ‘" |
| `/pets/0/name` | `pets.name` |
| è¿”å›ä¸€ä¸ªå€¼ | è¿”å›ç­›é€‰åçš„æ–‡æ¡£ |
| ç”¨äº**å®šä½** | ç”¨äº**ç­›é€‰** |

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

ç†è§£è¿™ä¸ª crate çš„å…³é”®ï¼š

1. **å¿˜è®°ç²¾ç¡®æ€§**ï¼šä¸è¦ç”¨æ ‡å‡† JSON Pointer çš„æ€ç»´æ–¹å¼
2. **æ‹¥æŠ±æ¨¡ç³Š**ï¼šç†è§£"èƒ½åŒ¹é…çš„éƒ½åŒ¹é…"çš„è®¾è®¡å“²å­¦
3. **çœ‹æµ‹è¯•ç”¨ä¾‹**ï¼š`lib.rs` ä¸­çš„æµ‹è¯•ç”¨ä¾‹æ˜¯æœ€å¥½çš„æ–‡æ¡£
4. **å…³æ³¨è¾¹ç•Œ**ï¼šé‡ç‚¹çœ‹ `contained_in()` å‡½æ•°å¦‚ä½•åˆ¤æ–­åŒ¹é…

---

## ğŸ“š ç›¸å…³èµ„æº

- [RFC 6901 - JSON Pointer æ ‡å‡†](https://tools.ietf.org/html/rfc6901)
- [Meilisearch æ–‡æ¡£ - Attributes to Retrieve](https://www.meilisearch.com/docs)
- æºç ï¼š`crates/permissive-json-pointer/src/lib.rs`
